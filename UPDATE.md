1# 下载库版本升级清单

####
**更新时间：2017-10-10**
**版本号：5.0.3**
**版本值：71**
**修改内容：**
```
1. 修改rar解压时中文乱码问题
```

####
**更新时间：2017-09-6**
**版本号：5.0.2**
**版本值：70**
**修改内容：**
```
1. 修改当销毁service时，调用mHandler为空的异常
```

####
**更新时间：2017-09-6**
**版本号：5.0.0**
**版本值：67**
**修改内容：**
```
1. 兼容老版本下载库（有些应用会通过老版本下载器把数据库创建在应用内，导致跟新版本数据库的版本号和表字段都不一致。）
```

####
**更新时间：2017-08-22**
**版本号：4.0.23-bugfix**
**版本值：65**
**修改内容：**
```
1. 添加未正常初始化的容错(版本更新库调用下载库会出现未正常初始化话的情况)。
```

####
**更新时间：2017-08-14**
**版本号：4.0.22-bugfix**
**版本值：64**
**修改内容：**
```
1. 修复解压时，utf-8格式可能出现乱码的bug。
```

####
**更新时间：2017-08-01**     
**版本号：4.0.20-bugfix**      
**版本值：62**      
**修改内容：**       
```
1. 去除解压兼容utf-8导致GBK格式乱码的问题（暂时不兼容utf-8，后续更新）
```

####
**更新时间：2017-07-27**     
**版本号：4.0.19-bugfix**      
**版本值：61**      
**修改内容：**       
```
1. 优化下载速度：去掉outputStream.sync()（该方法耗时导致循环写数据变慢）
```

####
**更新时间：2017-07-24**     
**版本号：4.0.16-bugfix**      
**版本值：58**      
**修改内容：**       
```
1. 优化下载速度：去掉下载写数据的循环里的打印和检测网络状态的方法。
```

####
**更新时间：2017-07-10**     
**版本号：4.0.14-bugfix**      
**版本值：57**      
**修改内容：**       
```
1. 去掉查询下载任务时,会启动服务的问题
2. 默认关闭静态监听网络变化的Receiver, 使用白名单, 按需打开
3. 修改下载一半,切换认证网络,下载的文件有损坏的bug
4. 下载重试代码的重构
5. 修改解压rar文件依赖jar包, 去掉不需要的资源
6. 减慢默认下载回调的频率
```

####
**更新时间：2017-06-29**     
**版本号：4.0.9-bugfix**      
**版本值：52**      
**修改内容：**       
```
1. 下载任务流程重试机制重构
2. 使用空配置,初始化可能有异常的bug
```

####
**更新时间：2017-06-23**     
**版本号：4.0.7-bugfix**      
**版本值：50**      
**修改内容：**       
```
1. 修改在下载回调监听中, 删除下载任务, 可能造成其他下载任务流程中断的bug
2. 修改初始化的调用逻辑, 修改随机提示未初始化抛出的异常, 方便跟踪调用逻辑
```

####
**更新时间：2017-06-16**     
**版本号：4.0.5-bugfix**      
**版本值：48**      
**修改内容：**       
```
1. 解决下载随机无法下载的问题
2. 将NoRouterToHost的异常,加入下载重试
3. 修改一次新增由于死锁造成的ANR
```

####
**更新时间：2017-06-15**     
**版本号：4.0.4-bugfix**      
**版本值：47**      
**修改内容：**       
```
1. 添加超时自动释放WakeLock, 防止在遇到未知异常,造成长时间无法释放的问题;
2. 添加部分log, 方便后续问题的排查
```

####
**更新时间：2017-06-12**     
**版本号：4.0.3-bugfix**      
**版本值：46**      
**修改内容：**       
```
1. 修改下载过程中, 可能死锁造成ANR的bug
2. 修改初始化过程中, 调用Context.getExternalCacheDir()造成ANR的问题
3. 修改超时等待时长, 和因为超时失败重试的次数
4. 将初始化配置保存的方式由静态变量改成单例
```

####
**更新时间：2017-06-06**     
**版本号：4.0.2-bugfix**      
**版本值：45**      
**修改内容：**       
```
1. 修改认证网络的下载检测, 认证网络下载的网页判定为下载失败
2. demo添加网络测试的ping功能
```


####
**更新时间：2017-06-02**     
**版本号：4.0.1-bugfix**      
**版本值：44**      
**修改内容：**       
```
1. 修改重试逻辑, 在准备结束下载服务时, 额外检测网络状态, 重试
2. 修改磁盘保存逻辑, 不预先占用磁盘空间, 可能导致磁盘空间显示不正确的bug
3. 部分重构DownloadRunnable
```

####
**更新时间：2017-05-31**    
**版本号：4.0.0**    
**版本值：43**    
**修改内容：**     
```
1. 代码未做修改， 升级版本号
```

####
**更新时间：2017-05-26**    
**版本号：3.0.15-bugfix**    
**版本值：41**    
**修改内容：**     
```
1. 添加媒体库的log
2. 添加媒体库的删除
```

####
**更新时间：2017-05-25**    
**版本号：3.0.14-bugfix**    
**版本值：41**    
**修改内容：**     
```
1. 下载时,被系统强杀,无法恢复的bug
```

####
**更新时间：2017-05-24**    
**版本号：3.0.13-bugfix**    
**版本值：40**    
**修改内容：**     
```
1. 下载时,持有wake lock, 防止系统休眠
2. 添加解压成功的log
```

####
**更新时间：2017-05-23**    
**版本号：3.0.12-bugfix**    
**版本值：39**    
**修改内容：**     
```
1. 修复主动停止下载服务时, 概率性报ConcurrentModificationException的bug
2. 添加媒体库扫描, 对下载过程中的文件扫描进媒体库
```
####
**更新时间：2017-05-22**    
**版本号：3.0.11-bugfix**    
**版本值：38**    
**修改内容：**     
```
1.修复小文件MD5校验失败的错误
```
####
**更新时间：2017-05-22**    
**版本号：3.0.10-bugfix**    
**版本值：37**    
**修改内容：**     
```
1.添加对小文件的校验, 修复认证网络下载失败的bug
```

####
**更新时间：2017-05-19**    
**版本号：3.0.8-bugfix**    
**版本值：36**    
**修改内容：**     
```
1.修改网络状态变化的监听, 改成静态注册, 方便拉起服务
2.增加下载异常的重试次数
3.增加对DNS解析错误的异常捕获
```

####
**更新时间：2017-05-16**    
**版本号：3.0.7-bugfix**    
**版本值：35**    
**修改内容：**     
```
1.修复下载重试时,有可能NullPoint的bug
2.okHttp更换成为统一的版本
```

####
**更新时间：2017-05-11**
**版本号：3.0.6-bugfix**
**版本值：34**
**修改内容：**
```
1.升级okhttp, 修复下载url中含有特殊字符,下载失败的bug
```

####
**更新时间：2017-05-10**
**版本号：3.0.5-bugfix**
**版本值：33**
**修改内容：**
```
1.修改后缀名重复,文件名被截断的bug
2.修改默认的解压器
```

####
**更新时间：2017-03-16**
**版本号：3.0.0**
**版本值：30**
**修改内容：**
```
1.发布正式版本3.0.0。
2.完善对电信2G网络判断。
```

####
**更新时间：2017-02-17**
**版本号：2.2.0**
**版本值：28**
**修改内容：**
```
1.发布正式版本2.2.0
```

####
**更新时间：2017-02-09**
**版本号：2.1.2-rc**
**版本值：27**
**修改内容：**
```
1.修改下载状态显示延迟问题
2.对applicationId获取进行判断，防止应用不配置applicationId
3.修改某些情况下Demo界面进度显示0异常
4.增加将旧版数据复制到新版的支持，主要通过集成Demo中的两个工具类
```

#### 
**更新时间：2017-02-07**
**版本号：2.1.1-rc**
**版本值：26**
**修改内容：**
```
1.优化数据库操作，改为异步执行，提升下载速度
```

#### 
**更新时间：2017-01-09**
**版本号：2.0.5-rc**
**版本值：25**
**修改内容：**
```
1.修复下载sdk查询任务显示moduleName一直为默认值异常
2.Demo查看下载更多信息
3.完善文档
```

#### 
**更新时间：2017-01-04**
**版本号：2.0.4-rc**
**版本值：24**
**修改内容：**
```
1.优化回调，增加设置进度回调接口，按设置的时间间隔回调
2.Demo在单任务初始化界面增加设置进度回调间隔时间
3.升级数据库版本4，增加进度回调间隔时间字段
4.增加设置解压是否源文件接口
5.解决回调信息缺少模块名
6.优化代码
7.解决demo在4.4Android系统上的兼容性问题
```

#### 
**更新时间：2016-12-15**
**版本号：2.0.0**
**版本值：20**
**修改内容：**
```
1.增加设置是否允许在电信2g网络下进行下载，默认false（会造成电话无法拨打）
2.优化代码，修改静态代码检测出来的问题
3.增加LeakCanary内存泄露检测
4.优化ContentProvider Uri跨进程获取
5.修改API、readme文档
6.增加读取手机网络状态权限
7.优化代码，修改map遍历方式，getBytes增加编码
8.修改不是utf-8编码的旧文件
9.修改下载过程中发生重试导致不执行校验、解压
10.优化下载服务空闲状态触发时机
```

#### 
**更新时间：2016-11-15**
**版本号：1.0.0**
**版本值：19**
**修改内容：**
```
1.优化网络检测
2.优化删除任务某些情况下没有停止下载线程
3.统一version、build
4.优化demo输入法弹出，解决部分界面被遮挡
5.优化重新下载，重下时下载顺序不会改变
6.优化立即停止服务，会先暂停所有任务
7.解决在demo误调用立即停止导致某些操作失效问题
8.修改下载多线程同时操作导致后续任务等待问题
9.完善网页版说明文档,增加两个网络状态错误码
10.增加多渠道测试
11.优化网路不稳定情况下，读写io异常导致下载失败
12.优化网路不稳定时连接超时导致失败
13.下载完成时增加对缓存文件是否存在的判断
14.增加对操作（添加、删除任务）的监听
15.修改应用崩溃情况下下载服务重启时缓存的Context为空问题
16.优化存储空间满的处理，空间满时自动暂停，清理空间后需要调用恢复才能继续下载
```

#### 
**更新时间：2016-10-15**
**版本号：0.9.9**
**版本值：18**
**修改内容：**
```
1. 下载启动时输出版本信息打印
2. 文件名以及后缀解析处理方式优化，自动补充完整文件名，过滤非法字符
3. 文件名增加校验，长度不能超过255
4. 修改解压路径读取错误
5. 增加三个错误码：文件名长度超过255、文件名非法、连接异常
6. 优化demo任务显示，增加模块名提示
7. 优化demo任务配置灰选
8. 修改demo极限测试开始时间显示异常
9. 修改demo所有界面固定为竖屏
```